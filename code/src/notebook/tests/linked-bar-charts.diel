create event table filterChartEvent (
  minScore number,
  maxScore number
);


create output currentFilter as 
  select *
  from filterChartEvent
  where timestep = (
      select max(timestep) from filterChartEvent
    );

-- we will use scoreDistribution to filter gradeDistribution
-- NOTE: this is a great example for materialization when there are no dependencies
-- should implement
create output scoreDistributionStatic as
  select
    round(score / 10) * 10 as scoreBin,
    count(*) as count
  from scores
  group by scoreBin;

create output gradDistributedLinked as
  SELECT
    students.grade as grade,
    count(students.sId) as count
  from students
    join scores
      on scores.sId = students.sId
    join currentFilter
      on scores.score <= currentFilter.maxScore
      and scores.score >= currentFilter.minScore
  group by grade;